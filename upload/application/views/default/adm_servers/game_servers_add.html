<?php  if (!defined('BASEPATH')) exit('No direct script access allowed'); ?>
<a class="awesome" href="{site_url}adm_servers/view/game_servers">Â« {lang_adm_servers_game_servers}</a>&nbsp;
<h2>{lang_adm_servers_new_game_server}</h2>

<p>{lang_adm_servers_game_servers_documentation}</p>

<form action="{site_url}adm_servers/add/game_servers" method="post" accept-charset="utf-8">
	<input type="hidden" name="<?php echo $this->security->get_csrf_token_name(); ?>" value="<?php echo $this->security->get_csrf_hash(); ?>" />
	<table class="zebra" width="100%">
		<tr>
			<td width="40%">{lang_name}:</td>
			<td><input type="text" name="name" /></td>
		</tr>

		<tr>
			<td>{lang_adm_servers_connect_data}:</td>
			<td><input value="" type="text" name="server_ip" />:<input size="6" type="text" name="server_port" /><span id="server_port_info"></span></td>
		</tr>
		
		<tr>
			<td>{lang_adm_servers_query_port}:<br /><span class="description">[ {lang_adm_servers_query_port_desc} ]</span></td>
				<td><input type="text" name="query_port" /><span id="query_port_info"></span></td>
			</tr>
			
			<tr>
				<td>{lang_adm_servers_rcon_port}:<br /><span class="description">[ {lang_adm_servers_rcon_port_desc} ]</span></td>
				<td><input type="text" name="rcon_port" /><span id="rcon_port_info"></span></td>
			</tr>

		<tr>
			<td>{lang_adm_servers_rcon_password}:</td>
			<td><input type="text" name="rcon" /></td>
		</tr>

		<tr>
			<td>{lang_game}:</td>
			<td>
				<select id="code" name="code">
					{games_list}
					<option value="{game_code}">{game_name}</option>
					{/games_list}
				 </select>
			</td>
		</tr>

		<tr>
			<td>{lang_adm_servers_game_type}:</td>
			<td>
				<span id="game_type"></span>
			</td>
		</tr>

		<tr>
			<td>{lang_dedicated_server}:</td>
			<td>
				<select name="ds_id">
					<option value="0" selected="selected">{lang_adm_servers_local_server}</option>
					{ds_list}
					<option value="{ds_id}">{ds_name}</option>
					{/ds_list}

				 </select>
			</td>
		</tr>
		
		<tr>
			<td>{lang_adm_servers_server_enabled}:</td>
			<td><input type="checkbox" name="enabled" value="1" checked="checked" /></td>
		</tr>

		<tr>
			<td>{lang_adm_servers_server_dir}:</td>
			<td><input type="text" name="dir" /></td>
		</tr>
		
		<tr>
			<td colspan="2"><p>{lang_adm_servers_absolute_path_to_server} <strong>"<span id="install_dir"></span>"</strong><br /><span class="description">[ {lang_adm_servers_server_dir_desc} ]</span></p></td>
		</tr>

		<input type="hidden" name="<?php echo $this->security->get_csrf_token_name(); ?>" value="<?php echo $this->security->get_csrf_hash(); ?>" />

		<script type="text/javascript">
		var ds_path;

		function AjaxFormRequest(result_id,form_id,url) { 
			jQuery.ajax({ 
				url:     	url,
				type:    	"POST",
				dataType:	"html",
				data: jQuery("form").serialize(),  
				success: function(response) {
					if(result_id == 'install_dir') {
						ds_path = response;
						document.getElementById('install_dir').innerHTML = ds_path + '/' + $("input[name='dir']").val();
					} else {
						document.getElementById(result_id).innerHTML = response;
					}
				}, 
				error: function(response) {
					document.getElementById(result_id).innerHTML = "{lang_error}"; 
				} 
			}); 
		}

		$(document).ready(function() {
			$("select[name='code']").change(function(){
				AjaxFormRequest('game_type', 'game_type', '{site_url}ajax/adm_servers/get_gametypes');
			});
			
			$("select[name='ds_id']").change(function() {
				AjaxFormRequest('install_dir', 'install_dir', '{site_url}ajax/adm_servers/get_ds_path');
			});
			
			$("input[name='dir']").keyup(function() {
				document.getElementById('install_dir').innerHTML = ds_path + '/' + $("input[name='dir']").val();
			});
			
			$("input[name='server_port']").change(function() {
				if($("input[name='server_port']").val()) {
					AjaxFormRequest('server_port_info', 'server_port_info', '{site_url}ajax/adm_servers/check_port/' + $("input[name='server_port']").val());
				}
			});
			
			$("input[name='query_port']").change(function() {
				if($("input[name='query_port']").val()) {
					AjaxFormRequest('query_port_info', 'query_port_info', '{site_url}ajax/adm_servers/check_port/' + $("input[name='query_port']").val());
				}
			});
			
			$("input[name='rcon_port']").change(function() {
				if($("input[name='rcon_port']").val()) {
					AjaxFormRequest('rcon_port_info', 'rcon_port_info', '{site_url}ajax/adm_servers/check_port/' + $("input[name='rcon_port']").val());
				}
			});
		});

		window.onload = AjaxFormRequest('game_type', 'game_type', '{site_url}ajax/adm_servers/get_gametypes');
		window.onload = AjaxFormRequest('install_dir', 'install_dir', '{site_url}ajax/adm_servers/get_ds_path');
		</script>

		<tr>
			<td></td>
			<td><input class="button" type="submit" name="server_add" value="{lang_add}" /></td>
		</tr>

	</table>

</form>
