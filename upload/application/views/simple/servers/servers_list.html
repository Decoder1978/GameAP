<?php  if (!defined('BASEPATH')) exit('No direct script access allowed'); ?>
<div class="full_w">
	<div class="entry">
		<div class="sep"></div>
	</div>
					
	<table class="zebra" width="100%">
		<thead>
		<tr>
			<th><strong>{lang_server_name}</strong></th>
			<th><strong>{lang_server_ip}</strong></th>
	<!--
			<?php /* if(module_exists('commercial')): */?><th><strong>{lang_main_server_expires}</strong></th><?php /* endif; */?>
	-->
			<th><strong>{lang_status}</strong></th>
			<th><strong>{lang_commands}</strong></th>
		</tr>
		</thead>
		
		<script type="text/javascript">
			var status = new Array();
			var privileges = new Array(['start', 'stop', 'restart']);
			
			function GetStatus(server_id) {
				jQuery.ajax({ 
					url:     '{site_url}ajax/server_control/get_status/' + server_id,
					type:     "GET",
					dataType: "html",
					success: function(response) {
						status[server_id] = Number(response);
						
						if (response == 1) {
							document.getElementById("status_" + server_id).innerHTML = "<img src=\"{base_url}themes/system/images/bullet_green.png\"/>";
							
							if (privileges['stop_' + server_id] == 1) {
								$("#commands_" + server_id).append("<a class=\"table-icon stop\" href=\"{site_url}server_command/stop/" + server_id + "\" title=\"{lang_stop}\"></a>&nbsp;&nbsp;");
							}
							
							if (privileges['restart_' + server_id] == 1) {
								$("#commands_" + server_id).append("<a class=\"table-icon restart\" href=\"{site_url}server_command/restart/" + server_id + "\" title=\"{lang_restart}\"></a>&nbsp;&nbsp;");
							}
						} else {
							document.getElementById("status_" + server_id).innerHTML = "<img src=\"{base_url}themes/system/images/bullet_red.png\"/>";
							
							if (privileges['start_' + server_id] == 1) {
								$("#commands_" + server_id).append("<a class=\"table-icon start\" href=\"{site_url}server_command/start/" + server_id + "\" title=\"{lang_start}\"></a>&nbsp;&nbsp;");
							}
							
							if (privileges['restart_' + server_id] == 1) {
								$("#commands_" + server_id).append("<a class=\"table-icon restart\" href=\"{site_url}server_command/restart/" + server_id + "\" title=\"{lang_restart}\"></a>&nbsp;&nbsp;");
							}
						}
						
						$("#commands_" + server_id).append("<a class=\"table-icon edit\" href=\"{site_url}admin/server_control/main/" + server_id + "\" title=\"{lang_other_commands}\"></a>&nbsp;&nbsp;");
						
					}, 
					error: function(response) {
						document.getElementById("status_" + server_id).innerHTML = "<img src=\"{base_url}themes/system/images/bullet_red.png\"/>";
						$("#commands_" + server_id).append("<a class=\"table-icon edit\" href=\"{site_url}admin/server_control/main/" + server_id + "\" title=\"{lang_other_commands}\"></a>&nbsp;&nbsp;");
					} 
				});
			}
		</script>
		
	{games_list}
		<tbody>
			<tr>
				<td align="center" colspan="5">{game_name}</td>
			</tr>
		</tbody>
		{servers_list}
			<tr>
				<td>{server_name}</td>
				<td>{server_ip}</td>
				<?php if(in_array('commercial', $this->gameap_modules->modules_list)): ?><td>{server_expires}</td><?php endif; ?>
				<td><div id="status_{server_id}"><img src="{base_url}themes/system/images/bullet_grey.png"/></div></td>
				<td><div id="commands_{server_id}"></div></td>
			</tr>
			
			<script type="text/javascript">
				{server_js_privileges}
				GetStatus({server_id});
			</script>
		{/servers_list}
	{/games_list}
	</table>
</div>
